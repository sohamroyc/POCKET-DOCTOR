<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pocket Doctor ‚Äì Your Personal AI Symptom Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f8ff;
        }
        
        .chat-container {
            height: 65vh;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxkZWZzPjxwYXR0ZXJuIGlkPSJwYXR0ZXJuIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHBhdHRlcm5UcmFuc2Zvcm09InJvdGF0ZSg0NSkiPjxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0icmdiYSgyMzksMjQ2LDI1NSwwLjAzKSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3QgZmlsbD0idXJsKCNwYXR0ZXJuKSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIvPjwvc3ZnPg==');
        }
        
        .message {
            max-width: 80%;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .typing-indicator::after {
            content: "...";
            animation: typing 1.5s infinite;
        }
        
        @keyframes typing {
            0% { content: "."; }
            33% { content: ".."; }
            66% { content: "..."; }
        }
        
        .symptom-btn {
            transition: all 0.2s ease;
        }
        
        .symptom-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="bg-white rounded-full p-2 shadow-lg">
                        <i class="fas fa-heartbeat text-blue-500 text-2xl"></i>
                    </div>
                    <h1 class="text-2xl font-bold">Pocket Doctor</h1>
                </div>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="#" class="hover:underline">Home</a>
                    <a href="#" class="hover:underline">About</a>
                    <a href="#" class="hover:underline">FAQ</a>
                    <button class="bg-white text-blue-600 px-4 py-2 rounded-full font-medium hover:bg-blue-50 transition">
                        Emergency
                    </button>
                </div>
                <button class="md:hidden text-2xl">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Chat Section -->
            <div class="lg:col-span-2 bg-white rounded-xl shadow-xl overflow-hidden">
                <div class="bg-blue-600 text-white px-6 py-4 flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <div class="w-10 h-10 bg-blue-400 rounded-full flex items-center justify-center">
                                <i class="fas fa-robot text-xl"></i>
                            </div>
                            <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-blue-600"></span>
                        </div>
                        <div>
                            <h3 class="font-bold">Dr. AI Assistant</h3>
                            <p class="text-xs opacity-80">Online</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center hover:bg-blue-400 transition">
                            <i class="fas fa-phone-alt text-xs"></i>
                        </button>
                        <button class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center hover:bg-blue-400 transition">
                            <i class="fas fa-video text-xs"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Chat Messages -->
                <div class="chat-container overflow-y-auto p-6 space-y-4" id="chat-messages">
                    <!-- Initial bot message -->
                    <div class="message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4">
                        <p class="font-medium text-blue-800">Hello! I'm your Pocket Doctor assistant. How can I help you today?</p>
                        <p class="text-sm text-blue-600 mt-1">You can describe your symptoms or select from common issues below:</p>
                        <div class="flex flex-wrap gap-2 mt-3">
                            <button class="symptom-btn bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm hover:bg-blue-200" onclick="selectSymptom('headache')">
                                Headache
                            </button>
                            <button class="symptom-btn bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm hover:bg-blue-200" onclick="selectSymptom('fever')">
                                Fever
                            </button>
                            <button class="symptom-btn bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm hover:bg-blue-200" onclick="selectSymptom('cough')">
                                Cough
                            </button>
                            <button class="symptom-btn bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm hover:bg-blue-200" onclick="selectSymptom('stomach pain')">
                                Stomach Pain
                            </button>
                            <button class="symptom-btn bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm hover:bg-blue-200" onclick="selectSymptom('fatigue')">
                                Fatigue
                            </button>
                            <button class="symptom-btn bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm hover:bg-green-200" onclick="showHealthQuiz()">
                                Health Quiz
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Input -->
                <div class="border-t border-gray-200 p-4 bg-gray-50">
                    <div class="flex items-center space-x-2">
                        <input type="text" id="user-input" placeholder="Describe your symptoms..." class="flex-grow px-4 py-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button id="send-btn" class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700 transition">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2 text-center">Pocket Doctor provides health information, not medical diagnosis or treatment.</p>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Emergency Card -->
                <div class="bg-red-50 border border-red-200 rounded-xl p-6 shadow-sm">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="bg-red-100 p-3 rounded-full">
                            <i class="fas fa-exclamation-triangle text-red-600"></i>
                        </div>
                        <h3 class="font-bold text-red-800">Emergency Symptoms</h3>
                    </div>
                    <ul class="space-y-2 text-sm text-red-700">
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-check-circle text-red-500 mt-1"></i>
                            <span>Chest pain or pressure</span>
                        </li>
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-check-circle text-red-500 mt-1"></i>
                            <span>Difficulty breathing</span>
                        </li>
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-check-circle text-red-500 mt-1"></i>
                            <span>Severe bleeding</span>
                        </li>
                        <li class="flex items-start space-x-2">
                            <i class="fas fa-check-circle text-red-500 mt-1"></i>
                            <span>Sudden weakness or numbness</span>
                        </li>
                    </ul>
                    <button class="w-full mt-4 bg-red-600 text-white py-2 rounded-lg font-medium hover:bg-red-700 transition flex items-center justify-center space-x-2">
                        <i class="fas fa-phone-alt"></i>
                        <span>Call Emergency</span>
                    </button>
                </div>
                
                <!-- Nearby Clinics -->
                <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-map-marker-alt text-blue-600"></i>
                        </div>
                        <h3 class="font-bold text-blue-800">Nearby Clinics</h3>
                    </div>
                    <div class="space-y-4" id="clinics-list">
                        <!-- Clinic items will be added here by JavaScript -->
                        <div class="flex items-start space-x-3">
                            <div class="bg-blue-50 p-2 rounded-lg">
                                <i class="fas fa-hospital text-blue-500"></i>
                            </div>
                            <div>
                                <h4 class="font-medium">City Medical Center</h4>
                                <p class="text-sm text-gray-600">1.2 miles away</p>
                                <div class="flex space-x-2 mt-1">
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Open Now</span>
                                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">24/7</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="bg-blue-50 p-2 rounded-lg">
                                <i class="fas fa-clinic-medical text-blue-500"></i>
                            </div>
                            <div>
                                <h4 class="font-medium">HealthPlus Clinic</h4>
                                <p class="text-sm text-gray-600">2.5 miles away</p>
                                <div class="flex space-x-2 mt-1">
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Open Now</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="find-clinics" class="w-full mt-4 bg-blue-600 text-white py-2 rounded-lg font-medium hover:bg-blue-700 transition flex items-center justify-center space-x-2 pulse">
                        <i class="fas fa-location-arrow"></i>
                        <span>Find Clinics Near Me</span>
                    </button>
                </div>
                
                <!-- Health Tips -->
                <div class="bg-green-50 border border-green-200 rounded-xl p-6 shadow-sm">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-heartbeat text-green-600"></i>
                        </div>
                        <h3 class="font-bold text-green-800">Daily Health Tip</h3>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-inner">
                        <p class="text-sm text-gray-700">"Staying hydrated helps maintain energy levels and supports all bodily functions. Aim for 8 glasses of water daily."</p>
                    </div>
                    <button class="w-full mt-4 bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition">
                        More Health Tips
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">Pocket Doctor</h3>
                    <p class="text-gray-400">Your personal AI health assistant, available 24/7 to provide medical information and guidance.</p>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Quick Links</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Home</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">About Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Privacy Policy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Terms of Service</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Resources</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Health Articles</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Symptom Checker</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">First Aid Guide</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Medication Database</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Contact</h4>
                    <ul class="space-y-2">
                        <li class="flex items-center space-x-2">
                            <i class="fas fa-envelope text-gray-400"></i>
                            <span class="text-gray-400">support@pocketdoctor.com</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i class="fas fa-phone text-gray-400"></i>
                            <span class="text-gray-400">+1 (800) 123-4567</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i class="fas fa-map-marker-alt text-gray-400"></i>
                            <span class="text-gray-400">123 Health St, Medville</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>¬© 2023 Pocket Doctor. All rights reserved. This application does not provide medical diagnosis or treatment.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chat-messages');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');
            const findClinicsBtn = document.getElementById('find-clinics');
            
            // Sample responses for different symptoms
            const symptomResponses = {
                'headache': {
                    causes: [
                        "Tension headaches (most common)",
                        "Migraine",
                        "Dehydration",
                        "Eye strain",
                        "Sinus congestion"
                    ],
                    advice: [
                        "Rest in a quiet, dark room",
                        "Apply a cold compress to your forehead",
                        "Stay hydrated by drinking water",
                        "Consider over-the-counter pain relievers like ibuprofen or acetaminophen",
                        "Practice relaxation techniques like deep breathing"
                    ],
                    warning: "Seek immediate medical attention if your headache is sudden and severe, or accompanied by fever, stiff neck, confusion, or vision changes."
                },
                'fever': {
                    causes: [
                        "Viral infection (most common)",
                        "Bacterial infection",
                        "Heat exhaustion",
                        "Certain medications",
                        "Autoimmune disorders"
                    ],
                    advice: [
                        "Stay hydrated with water, broth, or electrolyte solutions",
                        "Rest as much as possible",
                        "Use a fever reducer like acetaminophen or ibuprofen",
                        "Apply cool compresses to your forehead and neck",
                        "Wear lightweight clothing"
                    ],
                    warning: "Seek medical help if fever is above 103¬∞F (39.4¬∞C), lasts more than 3 days, or is accompanied by severe headache, stiff neck, difficulty breathing, or rash."
                },
                'cough': {
                    causes: [
                        "Common cold or flu",
                        "Allergies",
                        "Postnasal drip",
                        "Asthma",
                        "Acid reflux"
                    ],
                    advice: [
                        "Stay hydrated to thin mucus",
                        "Use cough drops or hard candy to soothe throat",
                        "Try honey (1-2 teaspoons) to relieve cough",
                        "Use a humidifier to moisten air",
                        "Elevate your head while sleeping"
                    ],
                    warning: "See a doctor if cough lasts more than 3 weeks, produces blood, causes difficulty breathing, or is accompanied by fever over 100.4¬∞F (38¬∞C)."
                },
                'stomach pain': {
                    causes: [
                        "Indigestion",
                        "Gas",
                        "Food intolerance",
                        "Stomach virus",
                        "Constipation"
                    ],
                    advice: [
                        "Try the BRAT diet (bananas, rice, applesauce, toast)",
                        "Apply a warm compress to your abdomen",
                        "Drink peppermint or ginger tea",
                        "Avoid fatty, spicy, or acidic foods",
                        "Take small, frequent meals"
                    ],
                    warning: "Seek emergency care if pain is severe, localized to one area, or accompanied by vomiting blood, black stools, or inability to pass stool with vomiting."
                },
                'fatigue': {
                    causes: [
                        "Lack of sleep",
                        "Stress or anxiety",
                        "Poor nutrition",
                        "Anemia",
                        "Underactive thyroid"
                    ],
                    advice: [
                        "Maintain a regular sleep schedule",
                        "Stay physically active with moderate exercise",
                        "Eat balanced meals with protein, complex carbs, and healthy fats",
                        "Stay hydrated",
                        "Practice stress-reduction techniques"
                    ],
                    warning: "Consult a doctor if fatigue persists for more than 2 weeks despite lifestyle changes, or is accompanied by unexplained weight loss, swollen lymph nodes, or depression."
                }
            };
            
            // Health quiz questions
            const healthQuiz = [
                {
                    question: "How many glasses of water should you drink daily?",
                    options: ["4-6", "6-8", "8-10", "10-12"],
                    correct: 1,
                    explanation: "The general recommendation is 6-8 glasses of water daily, but this can vary based on activity level, climate, and individual needs."
                },
                {
                    question: "Which vitamin is produced by the skin when exposed to sunlight?",
                    options: ["Vitamin A", "Vitamin C", "Vitamin D", "Vitamin E"],
                    correct: 2,
                    explanation: "Vitamin D is produced in the skin when it's exposed to ultraviolet B (UVB) rays from the sun."
                },
                {
                    question: "How many hours of sleep is recommended for adults?",
                    options: ["4-5 hours", "5-6 hours", "7-9 hours", "9-11 hours"],
                    correct: 2,
                    explanation: "Most adults need 7-9 hours of sleep per night for optimal health and functioning."
                }
            ];
            
            // User profile data
            let userProfile = {
                name: "",
                age: "",
                gender: "",
                symptoms: [],
                lastCheckup: "",
                vaccinations: [],
                moodHistory: []
            };
            
            // Family profiles
            let familyProfiles = [];
            
            // Symptom search history
            let symptomSearchHistory = [];
            
            // Offline mode flag
            let isOfflineMode = false;
            
            // Health risk levels
            const riskLevels = {
                LOW: { label: "LOW", color: "bg-green-500", text: "text-green-800" },
                MEDIUM: { label: "MEDIUM", color: "bg-yellow-500", text: "text-yellow-800" },
                HIGH: { label: "HIGH", color: "bg-red-500", text: "text-red-800" }
            };
            
            // Vaccination schedule based on age
            const vaccinationSchedule = {
                "0-2": [
                    { name: "Hepatitis B", doses: [0, 1, 6], months: [0, 1, 6] },
                    { name: "DTaP", doses: [0, 1, 2, 3, 4], months: [2, 4, 6, 15, 48] },
                    { name: "Hib", doses: [0, 1, 2, 3], months: [2, 4, 6, 12] },
                    { name: "IPV", doses: [0, 1, 2, 3], months: [2, 4, 6, 48] },
                    { name: "PCV13", doses: [0, 1, 2, 3], months: [2, 4, 6, 12] },
                    { name: "Rotavirus", doses: [0, 1, 2], months: [2, 4, 6] }
                ],
                "4-6": [
                    { name: "DTaP", doses: [4], months: [48, 60, 72] },
                    { name: "IPV", doses: [3], months: [48, 60, 72] },
                    { name: "MMR", doses: [0, 1], months: [12, 48] },
                    { name: "Varicella", doses: [0, 1], months: [12, 48] }
                ],
                "11-12": [
                    { name: "Tdap", doses: [0], months: [132, 144] },
                    { name: "HPV", doses: [0, 1, 2], months: [132, 138, 150] },
                    { name: "Meningococcal", doses: [0, 1], months: [132, 144] }
                ],
                "19-26": [
                    { name: "Tdap", doses: [0], months: [228, 240, 252, 264, 276, 288, 300, 312] },
                    { name: "HPV", doses: [0, 1, 2], months: [228, 234, 246] },
                    { name: "Meningococcal", doses: [0], months: [228, 240, 252, 264, 276, 288, 300, 312] },
                    { name: "Influenza", doses: [0], months: [228, 240, 252, 264, 276, 288, 300, 312] }
                ],
                "27-49": [
                    { name: "Tdap", doses: [0], months: [324, 336, 348, 360, 372, 384, 396, 408, 420, 432, 444, 456, 468, 480, 492, 504, 516, 528, 540, 552, 564, 576, 588] },
                    { name: "Influenza", doses: [0], months: [324, 336, 348, 360, 372, 384, 396, 408, 420, 432, 444, 456, 468, 480, 492, 504, 516, 528, 540, 552, 564, 576, 588] }
                ],
                "50-64": [
                    { name: "Tdap", doses: [0], months: [600, 612, 624, 636, 648, 660, 672, 684, 696, 708, 720, 732, 744, 756, 768] },
                    { name: "Influenza", doses: [0], months: [600, 612, 624, 636, 648, 660, 672, 684, 696, 708, 720, 732, 744, 756, 768] },
                    { name: "Zoster", doses: [0], months: [600, 612, 624, 636, 648, 660, 672, 684, 696, 708, 720, 732, 744, 756, 768] }
                ],
                "65+": [
                    { name: "Tdap", doses: [0], months: [780, 792, 804, 816, 828, 840, 852, 864, 876, 888, 900, 912, 924, 936, 948, 960, 972, 984, 996, 1008, 1020, 1032, 1044, 1056, 1068, 1080, 1092, 1104, 1116, 1128, 1140, 1152, 1164, 1176, 1188, 1200] },
                    { name: "Influenza", doses: [0], months: [780, 792, 804, 816, 828, 840, 852, 864, 876, 888, 900, 912, 924, 936, 948, 960, 972, 984, 996, 1008, 1020, 1032, 1044, 1056, 1068, 1080, 1092, 1104, 1116, 1128, 1140, 1152, 1164, 1176, 1188, 1200] },
                    { name: "Pneumococcal", doses: [0], months: [780, 792, 804, 816, 828, 840, 852, 864, 876, 888, 900, 912, 924, 936, 948, 960, 972, 984, 996, 1008, 1020, 1032, 1044, 1056, 1068, 1080, 1092, 1104, 1116, 1128, 1140, 1152, 1164, 1176, 1188, 1200] }
                ]
            };
            
            // Health checkup recommendations
            const healthCheckups = {
                "0-2": "Every 2-3 months for well-child visits",
                "3-5": "Annually for well-child visits",
                "6-12": "Annually for well-child visits",
                "13-18": "Annually for well-child visits",
                "19-39": "Every 3-5 years for general checkup",
                "40-49": "Every 2-3 years for general checkup",
                "50-64": "Annually for general checkup",
                "65+": "Annually for general checkup"
            };
            
            // Mood tracking options
            const moodOptions = [
                { value: 5, label: "Very Happy", emoji: "üòä", color: "bg-green-500" },
                { value: 4, label: "Happy", emoji: "üôÇ", color: "bg-green-400" },
                { value: 3, label: "Neutral", emoji: "üòê", color: "bg-yellow-400" },
                { value: 2, label: "Sad", emoji: "üôÅ", color: "bg-orange-400" },
                { value: 1, label: "Very Sad", emoji: "üò¢", color: "bg-red-500" }
            ];
            
            // Add a message to the chat
            function addMessage(sender, message, isBot = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isBot ? 'bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4' : 'bg-white rounded-tl-xl rounded-tr-xl rounded-bl-xl p-4 ml-auto border border-gray-200'}`;
                
                if (typeof message === 'string') {
                    messageDiv.innerHTML = `<p class="${isBot ? 'text-blue-800' : 'text-gray-800'}">${message}</p>`;
                } else {
                    // Handle structured messages (like symptom responses)
                    let html = '';
                    
                    if (message.causes) {
                        html += `<p class="font-medium ${isBot ? 'text-blue-800' : 'text-gray-800'} mb-2">Possible causes:</p>`;
                        html += `<ul class="list-disc pl-5 mb-3 ${isBot ? 'text-blue-700' : 'text-gray-700'}">`;
                        message.causes.forEach(cause => {
                            html += `<li class="mb-1">${cause}</li>`;
                        });
                        html += `</ul>`;
                    }
                    
                    if (message.advice) {
                        html += `<p class="font-medium ${isBot ? 'text-blue-800' : 'text-gray-800'} mb-2">Recommended actions:</p>`;
                        html += `<ul class="list-disc pl-5 mb-3 ${isBot ? 'text-blue-700' : 'text-gray-700'}">`;
                        message.advice.forEach(advice => {
                            html += `<li class="mb-1">${advice}</li>`;
                        });
                        html += `</ul>`;
                    }
                    
                    if (message.warning) {
                        html += `<div class="bg-red-50 border-l-4 border-red-500 p-3 rounded-r mb-2">`;
                        html += `<p class="font-medium text-red-700">‚ö†Ô∏è Warning:</p>`;
                        html += `<p class="text-red-600">${message.warning}</p>`;
                        html += `</div>`;
                    }
                    
                    messageDiv.innerHTML = html;
                }
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Show typing indicator
            function showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4';
                typingDiv.id = 'typing-indicator';
                typingDiv.innerHTML = '<p class="text-blue-800"><span class="typing-indicator">Dr. AI is typing</span></p>';
                chatMessages.appendChild(typingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Hide typing indicator
            function hideTypingIndicator() {
                const typingDiv = document.getElementById('typing-indicator');
                if (typingDiv) {
                    typingDiv.remove();
                }
            }
            
            // Show severity scale
            function showSeverityScale(symptom) {
                const severityDiv = document.createElement('div');
                severityDiv.className = 'message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4 mt-2';
                severityDiv.innerHTML = `
                    <p class="font-medium text-blue-800 mb-2">How would you rate your ${symptom} on a scale of 1-10?</p>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-blue-600">Mild (1)</span>
                        <div class="flex space-x-1">
                            ${Array.from({length: 10}, (_, i) => `
                                <button class="severity-btn w-8 h-8 rounded-full border-2 border-blue-300 hover:bg-blue-200 transition" data-value="${i+1}">${i+1}</button>
                            `).join('')}
                        </div>
                        <span class="text-sm text-blue-600">Severe (10)</span>
                    </div>
                `;
                
                chatMessages.appendChild(severityDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listeners to severity buttons
                const severityBtns = severityDiv.querySelectorAll('.severity-btn');
                severityBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const severity = parseInt(this.dataset.value);
                        
                        // Update UI to show selected severity
                        severityBtns.forEach(b => {
                            if (parseInt(b.dataset.value) <= severity) {
                                b.classList.add('bg-blue-500', 'text-white', 'border-blue-500');
                            } else {
                                b.classList.remove('bg-blue-500', 'text-white', 'border-blue-500');
                            }
                        });
                        
                        // Store severity in user profile
                        if (!userProfile.symptoms.find(s => s.name === symptom)) {
                            userProfile.symptoms.push({
                                name: symptom,
                                severity: severity,
                                date: new Date().toISOString()
                            });
                        } else {
                            userProfile.symptoms.find(s => s.name === symptom).severity = severity;
                        }
                        
                        // Provide appropriate response based on severity
                        setTimeout(() => {
                            let response = '';
                            if (severity <= 3) {
                                response = `Your ${symptom} seems mild. Continue with the recommended actions and monitor for any changes.`;
                            } else if (severity <= 7) {
                                response = `Your ${symptom} is moderate. Follow the recommended actions and consider over-the-counter remedies if appropriate.`;
                            } else {
                                response = `Your ${symptom} is severe. Please consider seeking medical attention, especially if it persists or worsens.`;
                            }
                            
                            addMessage('bot', response, true);
                            
                            // Ask for second opinion
                            setTimeout(() => {
                                addMessage('bot', 'Would you like a second opinion or more detailed information?', true);
                                addSecondOpinionButton(symptom);
                            }, 1000);
                        }, 1000);
                    });
                });
            }
            
            // Add second opinion button
            function addSecondOpinionButton(symptom) {
                const secondOpinionDiv = document.createElement('div');
                secondOpinionDiv.className = 'message bg-white rounded-tl-xl rounded-tr-xl rounded-bl-xl p-4 ml-auto border border-gray-200 mt-2';
                secondOpinionDiv.innerHTML = `
                    <button class="second-opinion-btn bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm hover:bg-blue-200 transition">
                        Need a second opinion
                    </button>
                `;
                
                chatMessages.appendChild(secondOpinionDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listener to second opinion button
                const secondOpinionBtn = secondOpinionDiv.querySelector('.second-opinion-btn');
                secondOpinionBtn.addEventListener('click', function() {
                    // Remove the button
                    secondOpinionDiv.remove();
                    
                    // Show typing indicator
                    showTypingIndicator();
                    
                    // Simulate second opinion after a delay
                    setTimeout(() => {
                        hideTypingIndicator();
                        
                        // Provide alternative perspective
                        let secondOpinion = '';
                        if (symptom === 'headache') {
                            secondOpinion = 'As a second opinion, I would also consider checking your posture and screen time, as these can contribute to headaches. Consider taking regular breaks from screens and practicing good ergonomics.';
                        } else if (symptom === 'fever') {
                            secondOpinion = 'As a second opinion, I would also recommend monitoring your temperature every 4-6 hours and noting any patterns. This information can be valuable for healthcare providers.';
                        } else if (symptom === 'cough') {
                            secondOpinion = 'As a second opinion, I would also suggest tracking when your cough is worse (day or night) and if it\'s dry or productive. This can help identify the underlying cause.';
                        } else if (symptom === 'stomach pain') {
                            secondOpinion = 'As a second opinion, I would also recommend keeping a food diary to identify any potential triggers for your stomach pain.';
                        } else if (symptom === 'fatigue') {
                            secondOpinion = 'As a second opinion, I would also consider checking your iron levels and sleep quality, as these are common contributors to fatigue.';
                        } else {
                            secondOpinion = 'As a second opinion, I would recommend consulting with a healthcare provider for a more comprehensive evaluation of your symptoms.';
                        }
                        
                        addMessage('bot', secondOpinion, true);
                        
                        // Offer to connect with a doctor
                        setTimeout(() => {
                            addMessage('bot', 'Would you like me to help you find a doctor or specialist in your area?', true);
                            addFindDoctorButton();
                        }, 1000);
                    }, 1500);
                });
            }
            
            // Add find doctor button
            function addFindDoctorButton() {
                const findDoctorDiv = document.createElement('div');
                findDoctorDiv.className = 'message bg-white rounded-tl-xl rounded-tr-xl rounded-bl-xl p-4 ml-auto border border-gray-200 mt-2';
                findDoctorDiv.innerHTML = `
                    <button class="find-doctor-btn bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm hover:bg-blue-200 transition">
                        Find a doctor
                    </button>
                `;
                
                chatMessages.appendChild(findDoctorDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listener to find doctor button
                const findDoctorBtn = findDoctorDiv.querySelector('.find-doctor-btn');
                findDoctorBtn.addEventListener('click', function() {
                    // Remove the button
                    findDoctorDiv.remove();
                    
                    // Trigger the find clinics functionality
                    findClinicsBtn.click();
                });
            }
            
            // Show health quiz
            function showHealthQuiz() {
                const quizDiv = document.createElement('div');
                quizDiv.className = 'message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4 mt-2';
                
                // Get a random quiz question
                const randomIndex = Math.floor(Math.random() * healthQuiz.length);
                const quiz = healthQuiz[randomIndex];
                
                quizDiv.innerHTML = `
                    <p class="font-medium text-blue-800 mb-2">Health Quiz:</p>
                    <p class="text-blue-700 mb-3">${quiz.question}</p>
                    <div class="space-y-2">
                        ${quiz.options.map((option, index) => `
                            <button class="quiz-option-btn w-full text-left px-4 py-2 rounded-lg border border-blue-200 hover:bg-blue-100 transition" data-index="${index}">
                                ${option}
                            </button>
                        `).join('')}
                    </div>
                `;
                
                chatMessages.appendChild(quizDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listeners to quiz option buttons
                const quizOptionBtns = quizDiv.querySelectorAll('.quiz-option-btn');
                quizOptionBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const selectedIndex = parseInt(this.dataset.index);
                        const isCorrect = selectedIndex === quiz.correct;
                        
                        // Update UI to show correct/incorrect
                        quizOptionBtns.forEach(b => {
                            if (parseInt(b.dataset.index) === quiz.correct) {
                                b.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                            } else if (parseInt(b.dataset.index) === selectedIndex && !isCorrect) {
                                b.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
                            }
                        });
                        
                        // Disable all buttons
                        quizOptionBtns.forEach(b => b.disabled = true);
                        
                        // Show explanation
                        setTimeout(() => {
                            const explanationDiv = document.createElement('div');
                            explanationDiv.className = 'message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4 mt-2';
                            explanationDiv.innerHTML = `
                                <p class="font-medium text-blue-800 mb-2">${isCorrect ? 'Correct!' : 'Incorrect'}</p>
                                <p class="text-blue-700">${quiz.explanation}</p>
                            `;
                            
                            chatMessages.appendChild(explanationDiv);
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                            
                            // Ask if user wants another quiz
                            setTimeout(() => {
                                addMessage('bot', 'Would you like another health quiz question?', true);
                                addAnotherQuizButton();
                            }, 1000);
                        }, 1000);
                    });
                });
            }
            
            // Add another quiz button
            function addAnotherQuizButton() {
                const anotherQuizDiv = document.createElement('div');
                anotherQuizDiv.className = 'message bg-white rounded-tl-xl rounded-tr-xl rounded-bl-xl p-4 ml-auto border border-gray-200 mt-2';
                anotherQuizDiv.innerHTML = `
                    <button class="another-quiz-btn bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm hover:bg-blue-200 transition">
                        Another quiz
                    </button>
                `;
                
                chatMessages.appendChild(anotherQuizDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listener to another quiz button
                const anotherQuizBtn = anotherQuizDiv.querySelector('.another-quiz-btn');
                anotherQuizBtn.addEventListener('click', function() {
                    // Remove the button
                    anotherQuizDiv.remove();
                    
                    // Show another quiz
                    showHealthQuiz();
                });
            }
            
            // Check for symptom trends
            function checkSymptomTrends(symptom) {
                // Find all instances of this symptom in the user's history
                const symptomHistory = userProfile.symptoms.filter(s => s.name === symptom);
                
                if (symptomHistory.length >= 3) {
                    // Sort by date
                    symptomHistory.sort((a, b) => new Date(a.date) - new Date(b.date));
                    
                    // Check if symptoms are occurring over multiple days
                    const firstDate = new Date(symptomHistory[0].date);
                    const lastDate = new Date(symptomHistory[symptomHistory.length - 1].date);
                    const daysDiff = Math.floor((lastDate - firstDate) / (1000 * 60 * 60 * 24));
                    
                    if (daysDiff >= 3) {
                        // Check if severity is increasing
                        const severityIncreasing = symptomHistory.every((s, i) => {
                            if (i === 0) return true;
                            return s.severity >= symptomHistory[i - 1].severity;
                        });
                        
                        if (severityIncreasing) {
                            return {
                                trend: "increasing",
                                days: daysDiff,
                                message: `I notice your ${symptom} has been occurring for ${daysDiff} days and the severity appears to be increasing. This could indicate a worsening condition. Please consider seeing a healthcare provider.`
                            };
                        } else {
                            return {
                                trend: "persistent",
                                days: daysDiff,
                                message: `I notice your ${symptom} has been occurring for ${daysDiff} days. While the severity isn't increasing, persistent symptoms should be evaluated by a healthcare provider.`
                            };
                        }
                    }
                }
                
                return null;
            }
            
            // Show vaccination tracker
            function showVaccinationTracker() {
                // Check if user profile has age
                if (!userProfile.age) {
                    addMessage('bot', 'To provide vaccination recommendations, I need to know your age. Would you like to set up your profile?', true);
                    addProfileSetupButton();
                    return;
                }
                
                const age = parseInt(userProfile.age);
                let ageGroup = "";
                
                if (age <= 2) ageGroup = "0-2";
                else if (age <= 6) ageGroup = "4-6";
                else if (age <= 12) ageGroup = "11-12";
                else if (age <= 26) ageGroup = "19-26";
                else if (age <= 49) ageGroup = "27-49";
                else if (age <= 64) ageGroup = "50-64";
                else ageGroup = "65+";
                
                const vaccinations = vaccinationSchedule[ageGroup] || [];
                const checkupRecommendation = healthCheckups[ageGroup] || "Annually for general checkup";
                
                const trackerDiv = document.createElement('div');
                trackerDiv.className = 'message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4 mt-2';
                
                let html = `
                    <p class="font-medium text-blue-800 mb-2">Vaccination & Health Checkup Tracker</p>
                    <p class="text-blue-700 mb-3">Based on your age (${age}), here are your recommended vaccinations and checkups:</p>
                    
                    <div class="mb-4">
                        <p class="font-medium text-blue-800 mb-2">Recommended Vaccinations:</p>
                        <ul class="list-disc pl-5 space-y-1 text-blue-700">
                `;
                
                if (vaccinations.length > 0) {
                    vaccinations.forEach(vaccine => {
                        html += `<li>${vaccine.name}</li>`;
                    });
                } else {
                    html += `<li>No specific vaccinations recommended for your age group</li>`;
                }
                
                html += `
                        </ul>
                    </div>
                    
                    <div class="mb-4">
                        <p class="font-medium text-blue-800 mb-2">Health Checkup Recommendation:</p>
                        <p class="text-blue-700">${checkupRecommendation}</p>
                    </div>
                    
                    <div class="mb-4">
                        <p class="font-medium text-blue-800 mb-2">Your Vaccination History:</p>
                `;
                
                if (userProfile.vaccinations.length > 0) {
                    html += `
                        <ul class="list-disc pl-5 space-y-1 text-blue-700">
                            ${userProfile.vaccinations.map(v => `<li>${v.name} - ${new Date(v.date).toLocaleDateString()}</li>`).join('')}
                        </ul>
                    `;
                } else {
                    html += `<p class="text-blue-700">No vaccinations recorded yet.</p>`;
                }
                
                html += `
                    </div>
                    
                    <div class="mb-4">
                        <p class="font-medium text-blue-800 mb-2">Last Checkup:</p>
                        <p class="text-blue-700">${userProfile.lastCheckup ? new Date(userProfile.lastCheckup).toLocaleDateString() : 'No checkup recorded yet.'}</p>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button class="add-vaccination-btn bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm hover:bg-blue-200 transition">
                            Add Vaccination
                        </button>
                        <button class="add-checkup-btn bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm hover:bg-blue-200 transition">
                            Record Checkup
                        </button>
                    </div>
                `;
                
                trackerDiv.innerHTML = html;
                chatMessages.appendChild(trackerDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listeners
                const addVaccinationBtn = trackerDiv.querySelector('.add-vaccination-btn');
                const addCheckupBtn = trackerDiv.querySelector('.add-checkup-btn');
                
                addVaccinationBtn.addEventListener('click', function() {
                    showAddVaccinationForm(ageGroup);
                });
                
                addCheckupBtn.addEventListener('click', function() {
                    showAddCheckupForm();
                });
            }
            
            // Show add vaccination form
            function showAddVaccinationForm(ageGroup) {
                const vaccinations = vaccinationSchedule[ageGroup] || [];
                
                const formDiv = document.createElement('div');
                formDiv.className = 'message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4 mt-2';
                
                let html = `
                    <p class="font-medium text-blue-800 mb-2">Add Vaccination</p>
                    <div class="mb-3">
                        <label class="block text-blue-700 mb-1">Select Vaccination:</label>
                        <select class="vaccination-select w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select a vaccination</option>
                            ${vaccinations.map(v => `<option value="${v.name}">${v.name}</option>`).join('')}
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3 other-vaccination-input hidden">
                        <label class="block text-blue-700 mb-1">Vaccination Name:</label>
                        <input type="text" class="other-vaccination-name w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter vaccination name">
                    </div>
                    <div class="mb-3">
                        <label class="block text-blue-700 mb-1">Date Received:</label>
                        <input type="date" class="vaccination-date w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex justify-end">
                        <button class="save-vaccination-btn bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition">
                            Save
                        </button>
                    </div>
                `;
                
                formDiv.innerHTML = html;
                chatMessages.appendChild(formDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listeners
                const vaccinationSelect = formDiv.querySelector('.vaccination-select');
                const otherVaccinationInput = formDiv.querySelector('.other-vaccination-input');
                const saveVaccinationBtn = formDiv.querySelector('.save-vaccination-btn');
                
                vaccinationSelect.addEventListener('change', function() {
                    if (this.value === 'other') {
                        otherVaccinationInput.classList.remove('hidden');
                    } else {
                        otherVaccinationInput.classList.add('hidden');
                    }
                });
                
                saveVaccinationBtn.addEventListener('click', function() {
                    const vaccinationName = vaccinationSelect.value === 'other' 
                        ? formDiv.querySelector('.other-vaccination-name').value 
                        : vaccinationSelect.value;
                    
                    const vaccinationDate = formDiv.querySelector('.vaccination-date').value;
                    
                    if (!vaccinationName || !vaccinationDate) {
                        addMessage('bot', 'Please fill in all fields.', true);
                        return;
                    }
                    
                    // Add vaccination to user profile
                    userProfile.vaccinations.push({
                        name: vaccinationName,
                        date: vaccinationDate
                    });
                    
                    // Remove form
                    formDiv.remove();
                    
                    // Show updated tracker
                    addMessage('bot', 'Vaccination recorded successfully!', true);
                    showVaccinationTracker();
                });
            }
            
            // Show add checkup form
            function showAddCheckupForm() {
                const formDiv = document.createElement('div');
                formDiv.className = 'message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4 mt-2';
                
                let html = `
                    <p class="font-medium text-blue-800 mb-2">Record Health Checkup</p>
                    <div class="mb-3">
                        <label class="block text-blue-700 mb-1">Checkup Date:</label>
                        <input type="date" class="checkup-date w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="mb-3">
                        <label class="block text-blue-700 mb-1">Notes (optional):</label>
                        <textarea class="checkup-notes w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Enter any notes about your checkup"></textarea>
                    </div>
                    <div class="flex justify-end">
                        <button class="save-checkup-btn bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition">
                            Save
                        </button>
                    </div>
                `;
                
                formDiv.innerHTML = html;
                chatMessages.appendChild(formDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listener
                const saveCheckupBtn = formDiv.querySelector('.save-checkup-btn');
                
                saveCheckupBtn.addEventListener('click', function() {
                    const checkupDate = formDiv.querySelector('.checkup-date').value;
                    const checkupNotes = formDiv.querySelector('.checkup-notes').value;
                    
                    if (!checkupDate) {
                        addMessage('bot', 'Please enter the checkup date.', true);
                        return;
                    }
                    
                    // Update last checkup in user profile
                    userProfile.lastCheckup = checkupDate;
                    
                    // Remove form
                    formDiv.remove();
                    
                    // Show updated tracker
                    addMessage('bot', 'Checkup recorded successfully!', true);
                    showVaccinationTracker();
                });
            }
            
            // Show mood tracker
            function showMoodTracker() {
                const trackerDiv = document.createElement('div');
                trackerDiv.className = 'message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4 mt-2';
                
                let html = `
                    <p class="font-medium text-blue-800 mb-2">How are you feeling today?</p>
                    <div class="flex justify-between items-center mb-4">
                        ${moodOptions.map(mood => `
                            <button class="mood-btn ${mood.color} text-white w-12 h-12 rounded-full flex items-center justify-center text-xl hover:opacity-80 transition" data-value="${mood.value}">
                                ${mood.emoji}
                            </button>
                        `).join('')}
                    </div>
                    <div class="mb-3">
                        <label class="block text-blue-700 mb-1">Would you like to share more about how you're feeling? (optional)</label>
                        <textarea class="mood-notes w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Share your thoughts..."></textarea>
                    </div>
                    <div class="flex justify-end">
                        <button class="save-mood-btn bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition">
                            Save
                        </button>
                    </div>
                `;
                
                trackerDiv.innerHTML = html;
                chatMessages.appendChild(trackerDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listeners
                const moodBtns = trackerDiv.querySelectorAll('.mood-btn');
                const saveMoodBtn = trackerDiv.querySelector('.save-mood-btn');
                
                let selectedMood = null;
                
                moodBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        selectedMood = parseInt(this.dataset.value);
                        
                        // Update UI
                        moodBtns.forEach(b => b.classList.remove('ring-4', 'ring-blue-300'));
                        this.classList.add('ring-4', 'ring-blue-300');
                    });
                });
                
                saveMoodBtn.addEventListener('click', function() {
                    if (!selectedMood) {
                        addMessage('bot', 'Please select your mood.', true);
                        return;
                    }
                    
                    const moodNotes = trackerDiv.querySelector('.mood-notes').value;
                    const selectedMoodOption = moodOptions.find(m => m.value === selectedMood);
                    
                    // Add mood to user profile
                    userProfile.moodHistory.push({
                        mood: selectedMood,
                        label: selectedMoodOption.label,
                        emoji: selectedMoodOption.emoji,
                        notes: moodNotes,
                        date: new Date().toISOString()
                    });
                    
                    // Remove tracker
                    trackerDiv.remove();
                    
                    // Show response based on mood
                    let response = '';
                    if (selectedMood <= 2) {
                        response = `I'm sorry you're feeling down. Remember that it's okay to not be okay. Would you like some resources for mental health support or some breathing exercises to help you feel better?`;
                        
                        // Show mental health resources
                        setTimeout(() => {
                            showMentalHealthResources();
                        }, 1000);
                    } else if (selectedMood === 3) {
                        response = `I'm glad you're feeling neutral. Sometimes a balanced mood is just what we need. Is there anything specific you'd like to talk about or any health concerns you have?`;
                    } else {
                        response = `I'm glad you're feeling good! Keep up the positive energy. Is there anything specific you'd like to talk about or any health concerns you have?`;
                    }
                    
                    addMessage('bot', response, true);
                });
            }
            
            // Show mental health resources
            function showMentalHealthResources() {
                const resourcesDiv = document.createElement('div');
                resourcesDiv.className = 'message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4 mt-2';
                
                let html = `
                    <p class="font-medium text-blue-800 mb-2">Mental Health Resources</p>
                    <div class="mb-4">
                        <p class="text-blue-700 mb-2">Here are some resources that might help:</p>
                        <ul class="list-disc pl-5 space-y-1 text-blue-700">
                            <li>National Crisis Hotline: 988 (US)</li>
                            <li>Crisis Text Line: Text HOME to 741741</li>
                            <li>Samaritans Helpline: 116 123 (UK)</li>
                            <li>Lifeline Australia: 13 11 14</li>
                        </ul>
                    </div>
                    <div class="mb-4">
                        <p class="font-medium text-blue-800 mb-2">Breathing Exercise</p>
                        <p class="text-blue-700 mb-2">Try this simple breathing exercise:</p>
                        <div class="bg-white p-4 rounded-lg">
                            <p class="text-gray-700 mb-2">1. Find a comfortable position</p>
                            <p class="text-gray-700 mb-2">2. Inhale slowly through your nose for 4 counts</p>
                            <p class="text-gray-700 mb-2">3. Hold your breath for 4 counts</p>
                            <p class="text-gray-700 mb-2">4. Exhale slowly through your mouth for 4 counts</p>
                            <p class="text-gray-700">5. Repeat 5-10 times</p>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button class="start-breathing-btn bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition">
                            Start Breathing Exercise
                        </button>
                    </div>
                `;
                
                resourcesDiv.innerHTML = html;
                chatMessages.appendChild(resourcesDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listener
                const startBreathingBtn = resourcesDiv.querySelector('.start-breathing-btn');
                
                startBreathingBtn.addEventListener('click', function() {
                    // Remove resources
                    resourcesDiv.remove();
                    
                    // Show breathing exercise
                    showBreathingExercise();
                });
            }
            
            // Show breathing exercise
            function showBreathingExercise() {
                const exerciseDiv = document.createElement('div');
                exerciseDiv.className = 'message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4 mt-2';
                
                let html = `
                    <p class="font-medium text-blue-800 mb-2">Breathing Exercise</p>
                    <div class="flex flex-col items-center justify-center mb-4">
                        <div class="breathing-circle w-32 h-32 rounded-full bg-blue-200 flex items-center justify-center mb-4">
                            <span class="breathing-text text-2xl font-bold text-blue-800">Ready</span>
                        </div>
                        <div class="breathing-instruction text-center text-blue-700 mb-2">Click "Start" to begin the breathing exercise</div>
                    </div>
                    <div class="flex justify-center">
                        <button class="start-exercise-btn bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition">
                            Start
                        </button>
                    </div>
                `;
                
                exerciseDiv.innerHTML = html;
                chatMessages.appendChild(exerciseDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listener
                const startExerciseBtn = exerciseDiv.querySelector('.start-exercise-btn');
                const breathingCircle = exerciseDiv.querySelector('.breathing-circle');
                const breathingText = exerciseDiv.querySelector('.breathing-text');
                const breathingInstruction = exerciseDiv.querySelector('.breathing-instruction');
                
                let isExercising = false;
                let exerciseInterval;
                
                startExerciseBtn.addEventListener('click', function() {
                    if (isExercising) {
                        // Stop exercise
                        clearInterval(exerciseInterval);
                        isExercising = false;
                        startExerciseBtn.textContent = 'Start';
                        breathingText.textContent = 'Ready';
                        breathingInstruction.textContent = 'Click "Start" to begin the breathing exercise';
                        breathingCircle.classList.remove('animate-pulse');
                    } else {
                        // Start exercise
                        isExercising = true;
                        startExerciseBtn.textContent = 'Stop';
                        
                        let phase = 0; // 0: inhale, 1: hold, 2: exhale
                        let count = 0;
                        
                        exerciseInterval = setInterval(() => {
                            if (phase === 0) {
                                // Inhale
                                breathingText.textContent = 'Inhale';
                                breathingInstruction.textContent = 'Breathe in through your nose';
                                breathingCircle.classList.add('animate-pulse');
                                count++;
                                
                                if (count >= 4) {
                                    phase = 1;
                                    count = 0;
                                }
                            } else if (phase === 1) {
                                // Hold
                                breathingText.textContent = 'Hold';
                                breathingInstruction.textContent = 'Hold your breath';
                                count++;
                                
                                if (count >= 4) {
                                    phase = 2;
                                    count = 0;
                                }
                            } else {
                                // Exhale
                                breathingText.textContent = 'Exhale';
                                breathingInstruction.textContent = 'Breathe out through your mouth';
                                count++;
                                
                                if (count >= 4) {
                                    phase = 0;
                                    count = 0;
                                }
                            }
                        }, 1000);
                    }
                });
            }
            
            // Add profile setup button
            function addProfileSetupButton() {
                const profileSetupDiv = document.createElement('div');
                profileSetupDiv.className = 'message bg-white rounded-tl-xl rounded-tr-xl rounded-bl-xl p-4 ml-auto border border-gray-200 mt-2';
                profileSetupDiv.innerHTML = `
                    <button class="profile-setup-btn bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm hover:bg-blue-200 transition">
                        Set up profile
                    </button>
                `;
                
                chatMessages.appendChild(profileSetupDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listener
                const profileSetupBtn = profileSetupDiv.querySelector('.profile-setup-btn');
                
                profileSetupBtn.addEventListener('click', function() {
                    // Remove the button
                    profileSetupDiv.remove();
                    
                    // Show profile setup form
                    showProfileSetupForm();
                });
            }
            
            // Show profile setup form
            function showProfileSetupForm() {
                const formDiv = document.createElement('div');
                formDiv.className = 'message bg-blue-50 rounded-tl-xl rounded-tr-xl rounded-br-xl p-4 mt-2';
                
                let html = `
                    <p class="font-medium text-blue-800 mb-2">Set Up Your Profile</p>
                    <div class="mb-3">
                        <label class="block text-blue-700 mb-1">Name:</label>
                        <input type="text" class="profile-name w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your name">
                    </div>
                    <div class="mb-3">
                        <label class="block text-blue-700 mb-1">Age:</label>
                        <input type="number" class="profile-age w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your age">
                    </div>
                    <div class="mb-3">
                        <label class="block text-blue-700 mb-1">Gender:</label>
                        <select class="profile-gender w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                            <option value="prefer-not-to-say">Prefer not to say</option>
                        </select>
                    </div>
                    <div class="flex justify-end">
                        <button class="save-profile-btn bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition">
                            Save
                        </button>
                    </div>
                `;
                
                formDiv.innerHTML = html;
                chatMessages.appendChild(formDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Add event listener
                const saveProfileBtn = formDiv.querySelector('.save-profile-btn');
                
                saveProfileBtn.addEventListener('click', function() {
                    const name = formDiv.querySelector('.profile-name').value;
                    const age = formDiv.querySelector('.profile-age').value;
                    const gender = formDiv.querySelector('.profile-gender').value;
                    
                    if (!name || !age || !gender) {
                        addMessage('bot', 'Please fill in all fields.', true);
                        return;
                    }
                    
                    // Update user profile
                    userProfile.name = name;
                    userProfile.age = age;
                    userProfile.gender = gender;
                    
                    // Remove form
                    formDiv.remove();
                    
                    // Show success message
                    addMessage('bot', 'Profile set up successfully!', true);
                    
                    // Show vaccination tracker
                    setTimeout(() => {
                        showVaccinationTracker();
                    }, 1000);
                });
            }
            
            // Process user input
            function processUserInput() {
                const text = userInput.value.trim();
                if (text === '') return;
                
                // Add user message to chat
                addMessage('user', text);
                userInput.value = '';
                
                // Show typing indicator
                showTypingIndicator();
                
                // Simulate bot response after a delay
                setTimeout(() => {
                    hideTypingIndicator();
                    
                    // Check if the input matches any known symptoms
                    let foundSymptom = null;
                    for (const symptom in symptomResponses) {
                        if (text.toLowerCase().includes(symptom)) {
                            foundSymptom = symptom;
                            break;
                        }
                    }
                    
                    if (foundSymptom) {
                        // Respond with symptom information
                        addMessage('bot', symptomResponses[foundSymptom], true);
                        
                        // Show severity scale
                        setTimeout(() => {
                            showSeverityScale(foundSymptom);
                        }, 1000);
                    } else if (text.toLowerCase().includes('quiz') || text.toLowerCase().includes('health quiz')) {
                        // Show health quiz
                        showHealthQuiz();
                    } else if (text.toLowerCase().includes('vaccin') || text.toLowerCase().includes('checkup')) {
                        // Show vaccination tracker
                        showVaccinationTracker();
                    } else if (text.toLowerCase().includes('mood') || text.toLowerCase().includes('feeling')) {
                        // Show mood tracker
                        showMoodTracker();
                    } else {
                        // Generic response for unrecognized input
                        addMessage('bot', 'I understand you\'re not feeling well. Could you please describe your symptoms in more detail or select from the common symptoms listed earlier?', true);
                    }
                }, 1500);
            }
            
            // Handle symptom button clicks
            window.selectSymptom = function(symptom) {
                // Add user message to chat
                addMessage('user', `I have ${symptom}.`);
                
                // Show typing indicator
                showTypingIndicator();
                
                // Simulate bot response after a delay
                setTimeout(() => {
                    hideTypingIndicator();
                    addMessage('bot', symptomResponses[symptom], true);
                    
                    // Show severity scale
                    setTimeout(() => {
                        showSeverityScale(symptom);
                    }, 1000);
                }, 1500);
            };
            
            // Find nearby clinics (simulated)
            findClinicsBtn.addEventListener('click', function() {
                // Show loading state
                const originalText = findClinicsBtn.innerHTML;
                findClinicsBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Finding clinics...';
                
                // Simulate API call
                setTimeout(() => {
                    // Restore button
                    findClinicsBtn.innerHTML = originalText;
                    
                    // Show success message in chat
                    addMessage('user', 'Find nearby clinics');
                    showTypingIndicator();
                    
                    setTimeout(() => {
                        hideTypingIndicator();
                        addMessage('bot', 'Here are the nearest medical facilities to your location:', true);
                        
                        // Simulated clinic data
                        const clinics = [
                            {
                                name: "City Medical Center",
                                distance: "1.2 miles",
                                open: true,
                                emergency: true
                            },
                            {
                                name: "HealthPlus Clinic",
                                distance: "2.5 miles",
                                open: true,
                                emergency: false
                            },
                            {
                                name: "Westside Urgent Care",
                                distance: "3.1 miles",
                                open: false,
                                emergency: false
                            }
                        ];
                        
                        // Display clinics
                        const clinicsList = document.getElementById('clinics-list');
                        clinicsList.innerHTML = '';
                        
                        clinics.forEach(clinic => {
                            const clinicDiv = document.createElement('div');
                            clinicDiv.className = 'flex items-start space-x-3';
                            
                            let statusBadge = '';
                            if (clinic.open) {
                                statusBadge = '<span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Open Now</span>';
                            } else {
                                statusBadge = '<span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">Closed</span>';
                            }
                            
                            let emergencyBadge = '';
                            if (clinic.emergency) {
                                emergencyBadge = '<span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">24/7</span>';
                            }
                            
                            clinicDiv.innerHTML = `
                                <div class="bg-blue-50 p-2 rounded-lg">
                                    <i class="fas ${clinic.emergency ? 'fa-hospital' : 'fa-clinic-medical'} text-blue-500"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">${clinic.name}</h4>
                                    <p class="text-sm text-gray-600">${clinic.distance} away</p>
                                    <div class="flex space-x-2 mt-1">
                                        ${statusBadge}
                                        ${emergencyBadge}
                                    </div>
                                </div>
                            `;
                            
                            clinicsList.appendChild(clinicDiv);
                        });
                    }, 1000);
                }, 2000);
            });
            
            // Event listeners
            sendBtn.addEventListener('click', processUserInput);
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    processUserInput();
                }
            });
            
            // Add health quiz button to the UI
            const healthQuizBtn = document.createElement('button');
            healthQuizBtn.className = 'symptom-btn bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm hover:bg-green-200';
            healthQuizBtn.innerHTML = 'Health Quiz';
            healthQuizBtn.addEventListener('click', function() {
                addMessage('user', 'Show me a health quiz');
                showHealthQuiz();
            });
            
            // Add mood tracker button to the UI
            const moodTrackerBtn = document.createElement('button');
            moodTrackerBtn.className = 'symptom-btn bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm hover:bg-purple-200';
            moodTrackerBtn.innerHTML = 'Mood Tracker';
            moodTrackerBtn.addEventListener('click', function() {
                addMessage('user', 'Track my mood');
                showMoodTracker();
            });
            
            // Add vaccination tracker button to the UI
            const vaccinationTrackerBtn = document.createElement('button');
            vaccinationTrackerBtn.className = 'symptom-btn bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm hover:bg-yellow-200';
            vaccinationTrackerBtn.innerHTML = 'Vaccination Tracker';
            vaccinationTrackerBtn.addEventListener('click', function() {
                addMessage('user', 'Show vaccination tracker');
                showVaccinationTracker();
            });
            
            // Add the buttons to the initial message
            document.addEventListener('DOMContentLoaded', function() {
                const initialMessage = document.querySelector('.message');
                if (initialMessage) {
                    const buttonsContainer = initialMessage.querySelector('.flex.flex-wrap.gap-2.mt-3');
                    if (buttonsContainer) {
                        buttonsContainer.appendChild(healthQuizBtn);
                        buttonsContainer.appendChild(moodTrackerBtn);
                        buttonsContainer.appendChild(vaccinationTrackerBtn);
                    }
                }
            });
        });
    </script>
<p style="border-radius: 8px; text-align: center; font-size: 12px; color: #fff; margin-top: 16px;position: fixed; left: 8px; bottom: 8px; z-index: 10; background: rgba(0, 0, 0, 0.8); padding: 4px 8px;">Made with <img src="https://enzostvs-deepsite.hf.space/logo.svg" alt="DeepSite Logo" style="width: 16px; height: 16px; vertical-align: middle;display:inline-block;margin-right:3px;filter:brightness(0) invert(1);"><a href="https://enzostvs-deepsite.hf.space" style="color: #fff;text-decoration: underline;" target="_blank" >DeepSite</a> - üß¨ <a href="https://enzostvs-deepsite.hf.space?remix=roychowdhurysoham2004/devfolio-hackathon" style="color: #fff;text-decoration: underline;" target="_blank" >Remix</a></p></body>
</html>